<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="clr-namespace:PRERP_TESTER.Models"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks">
    
    <!-- Module item -->
    <DataTemplate x:Key="MenuItemModule">
        <Border Background="Transparent"
                Tag="{Binding RelativeSource={RelativeSource AncestorType=ListBox}}">
            <Border.ContextMenu>
                <ContextMenu Style="{StaticResource TabContextMenuStyle}">
                    <MenuItem Command="{Binding PlacementTarget.Tag.DataContext.PinModuleCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                              CommandParameter="{Binding}">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem" BasedOn="{StaticResource TabContextMenuLeftStyle}">
                                <Setter Property="Header" Value="Ghim"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPinned}" Value="True">
                                        <Setter Property="Header" Value="Bỏ ghim"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial Width="15" Height="15"
                                                        Margin="5,0,10,0"
                                                        VerticalAlignment="Center">
                                <iconPacks:PackIconMaterial.Style>
                                    <Style TargetType="iconPacks:PackIconMaterial">
                                        <Setter Property="Kind" Value="PinOutline"/>
                                        <Setter Property="Foreground" Value="#FFC75555"/>
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <RotateTransform Angle="45"/>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsPinned}" Value="True">
                                                <Setter Property="Foreground" Value="DimGray"/>
                                                <Setter Property="Kind" Value="PinOffOutline"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </iconPacks:PackIconMaterial.Style>
                            </iconPacks:PackIconMaterial>
                        </MenuItem.Icon>
                    </MenuItem>

                    <MenuItem Header="Xóa module"
                              Style="{StaticResource TabContextMenuLeftStyle}"
                              Foreground="#EF4444"
                              Command="{Binding PlacementTarget.Tag.DataContext.RemoveModuleCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                              CommandParameter="{Binding}">
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial Kind="DeleteOutline" Width="14" Height="14" VerticalAlignment="Center" Foreground="#EF4444"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </ContextMenu>
            </Border.ContextMenu>
            <Grid Height="40" ToolTipService.InitialShowDelay="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="ToolTip" Value="{x:Null}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding DataContext.IsMenuCollapsed, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <ToolTip Style="{StaticResource TooltipMenuLeft}" Content="{Binding Name}"/>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <!-- Module Icon -->
                <Grid HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding DataContext.IsMenuCollapsed, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                    <Setter Property="Margin" Value="8,0,0,0"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <iconPacks:PackIconMaterial Kind="Folder" 
                                                Width="16" Height="16"
                                                Grid.Column="0"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center">
                        <iconPacks:PackIconMaterial.Style>
                            <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                <Setter Property="Foreground" Value="#FF9A9A9A"/>
                                <Setter Property="Margin" Value="10,0,0,0"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                        <Setter Property="Foreground" Value="#FFE2A862"/>
                                        <Setter Property="Margin" Value="10,0,0,0"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding DataContext.IsMenuCollapsed, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                        <Setter Property="Margin" Value="2,0,0,0"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </iconPacks:PackIconMaterial.Style>
                    </iconPacks:PackIconMaterial>

                </Grid>

                <!-- Module Name -->
                <TextBlock  Grid.Column="1"
					        VerticalAlignment="Center"
					        Text="{Binding Name}"
                            FontSize="15"
                            Margin="10,0,10,0"
					        TextTrimming="CharacterEllipsis">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#FF1F2937"/>
                            <Setter Property="FontSize" Value="13"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                    <Setter Property="Foreground" Value="#3883fb"/>
                                    <Setter Property="FontWeight" Value="Normal"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding DataContext.IsMenuCollapsed, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <iconPacks:PackIconMaterial Kind="PinOutline" Width="15" Height="15"
                                            Grid.Column="2"
                                            Foreground="#FFC75555" Margin="5,0,10,0"
                                            VerticalAlignment="Center">
                    <iconPacks:PackIconMaterial.Style>
                        <Style TargetType="iconPacks:PackIconMaterial">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Setter Property="RenderTransform">
                                <Setter.Value>
                                    <RotateTransform Angle="45"/>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsPinned}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding DataContext.IsMenuCollapsed, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </iconPacks:PackIconMaterial.Style>
                </iconPacks:PackIconMaterial>
            </Grid>
        </Border>
    </DataTemplate>
    
    <!-- Account Item-->
    <DataTemplate x:Key="MenuItemAccount">
        <Border Background="Transparent"
                Tag="{Binding RelativeSource={RelativeSource AncestorType=ListBox}}">
            <Border.ContextMenu>
                <ContextMenu Style="{StaticResource TabContextMenuStyle}">
                    <MenuItem Header="Thông tin" 
                          Style="{StaticResource TabContextMenuLeftStyle}"
                          Command="{Binding PlacementTarget.Tag.DataContext.ShowAccountDetailCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          CommandParameter="{Binding}">
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial Kind="CardAccountDetailsStarOutline" Width="14" Height="14"/>
                        </MenuItem.Icon>
                    </MenuItem>

                    <MenuItem Header="Chỉnh sửa" 
                          Style="{StaticResource TabContextMenuLeftStyle}"
                          Command="{Binding PlacementTarget.Tag.DataContext.EditAccountCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          CommandParameter="{Binding}">
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial Kind="PencilOutline" Width="14" Height="14"/>
                        </MenuItem.Icon>
                    </MenuItem>

                    <MenuItem Header="Xóa tài khoản" 
                          Style="{StaticResource TabContextMenuLeftStyle}"
                          Foreground="#EF4444"
                          Command="{Binding PlacementTarget.Tag.DataContext.RemoveAccountCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          CommandParameter="{Binding}">
                        <MenuItem.Icon>
                            <iconPacks:PackIconMaterial Kind="DeleteOutline" Width="14" Height="14" Foreground="#EF4444"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </ContextMenu>
            </Border.ContextMenu>
            <Grid Height="40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Width="30" Height="30" Margin="5,0,0,0" VerticalAlignment="Center">
                    <Grid>
                        <Border CornerRadius="15" 
                                Background="{Binding AvatarColor}" 
                                BorderBrush="#40000000" 
                                BorderThickness="0.5">
                            <TextBlock Text="{Binding Initials}" 
                               Foreground="White" 
                               FontSize="14" 
                               FontWeight="Bold"
                               VerticalAlignment="Center" 
                               HorizontalAlignment="Center"
                               Margin="0,0,0,1"/>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding AvatarUrl}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding AvatarUrl}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>

                        <Border CornerRadius="15" ClipToBounds="True" BorderThickness="1" BorderBrush="#40000000">
                            <Image Source="{Binding AvatarUrl, TargetNullValue={x:Null}, FallbackValue={x:Null}}" 
                                   Stretch="UniformToFill"
                                   RenderOptions.BitmapScalingMode="HighQuality">
                                <Image.Clip>
                                    <EllipseGeometry Center="15,15" RadiusX="15" RadiusY="15" />
                                </Image.Clip>
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AvatarUrl}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding AvatarUrl}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </Border>
                    </Grid>
                    <ToolTipService.InitialShowDelay>0</ToolTipService.InitialShowDelay>
                    <ToolTipService.BetweenShowDelay>0</ToolTipService.BetweenShowDelay>
                    <Border.ToolTip>
                        <ToolTip Padding="8,2" HasDropShadow="True"
                                     SnapsToDevicePixels="True" Style="{StaticResource TooltipAccountName}">
                            <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
                        </ToolTip>
                    </Border.ToolTip>
                </Border>
                <Border Grid.Column="0" VerticalAlignment="Bottom" HorizontalAlignment="Right" BorderBrush="White" BorderThickness="2">
                    <iconPacks:PackIconMaterial  Kind="CircleSmall" Foreground="#1e981e" Width="12" Height="12">
                        <iconPacks:PackIconMaterial.Style>
                            <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoggedIn}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsLoggedIn}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </iconPacks:PackIconMaterial.Style>
                    </iconPacks:PackIconMaterial>
                </Border>

                <Grid Grid.Column="1" VerticalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                                   Text="{Binding DisplayName}"
                                   VerticalAlignment="Center" 
                                   Margin="10,0,10,0"
                                   Foreground="#FF1F2937" FontSize="13" FontWeight="SemiBold"
                                   TextTrimming="CharacterEllipsis">
                        <TextBlock.ToolTip>
                            <ToolTip Padding="4,1" HasDropShadow="True"
                                         SnapsToDevicePixels="True" Style="{StaticResource TooltipAccountName}">
                                <TextBlock Text="{Binding DisplayName}"/>
                            </ToolTip>
                        </TextBlock.ToolTip>
                     </TextBlock>
                    <TextBlock Grid.Row="1" Text="{Binding Username}" VerticalAlignment="Center" 
                               Margin="10,0,0,0" Foreground="#FF1F2937" FontSize="13" TextTrimming="CharacterEllipsis"/>
                </Grid>
            </Grid>
        </Border>
    </DataTemplate>

</ResourceDictionary>
